---
title: "Mean weight of species per scenario"
author: "Ezekiel"
date: "2025-03-27"
output: Mean weight of species per scenario
---

Directory Set-up
```{r setup, include=FALSE}
library("here")
library(ggpubr)
library(dplyr)
library(mizer)
library("assertthat")
library("optimParallel")
library("here")
library("tidyr")
library(dplyr)
#library("nloptr")
library(mizerExperimental)
library(tidyverse)
library(mizerHowTo)
library(pbapply)
library(openair)
library(patchwork)
dir <- setwd(here())
knitr::opts_knit$set(root.dir = "~/Mac/Dropbox/Desktop/Ezekiel/Eastern Scotian Shelf Model/Eastern-Scotian-Shelf-Model/")
knitr::opts_knit$set(root.dir = dir)

# Define the save directory
save_dir <- paste0(here(), "/Ess_Output/")
```

Extraction of  data
```{r}
biomass_extract <- read.csv("Ess_data/biomass_extract.csv")
yield_extract <- read.csv("Ess_data/yield_extract.csv")
biomass_sim_base<- read.csv("Ess_data/biomass_sim_base.csv")
biomass_sim_opt<- read.csv("Ess_data/biomass_sim_opt.csv")
yield_sim_base<- read.csv("Ess_data/yield_sim_base.csv")
yield_sim_opt<- read.csv("Ess_data/yield_sim_opt.csv")
biomass_ts<-readRDS("Ess_data/biomass_ts.RDS")
biomass_ts<-biomass_ts |> rename(Biomass_Obs=Biomass) 
yield_ts<-readRDS("Ess_data/yield_ts.RDS")
yield_ts<-yield_ts |> rename(Yield_Obs=Yield)
```

Get biomass per Scenario
```{r}
sims_scen1 <- readRDS("Ess_output/sims_scen1.RDS")
sims_scen2 <- readRDS("Ess_output/sims_scen2.RDS")
sim_bio<-lapply(sims_scen1,getBiomass,min_w=species_params(params)$biomass_cutoff)
sim_bio2<-lapply(sims_scen2,getBiomass,min_w=species_params(params)$biomass_cutoff)

df_sim_bio<-do.call(rbind.data.frame, sim_bio)
df_sim_bio$sim<-rep(1:100, each=41)
df_sim_bio$year<-rep(1970:2010,100)

df_sim_bio2 <-do.call(rbind.data.frame, sim_bio2)
df_sim_bio2$sim <-rep(1:100, each=41)
df_sim_bio2$year<-rep(1970:2010,100)

```

MeanWeight plot
Data cleaning dermasal
```{r}
#Biomass per length data cleaning
biop <- read.csv("Ess_data/biomass_at_length_DFO_model_spp.csv") %>%
  pivot_longer(!c(length_cm, YEAR), names_to = "SPECIES", values_to = "BIOMASS", values_drop_na = TRUE) %>%
  filter(length_cm >= 10) %>%
  group_by(YEAR, SPECIES) %>%
  summarise(BIOMASS = sum(BIOMASS, na.rm = TRUE), .groups = "drop") %>%
  pivot_wider(names_from = SPECIES, values_from = BIOMASS, values_fill = 0)
biop <- biop %>%
  rename(
    "AMERICAN PLAICE" = AMERICAN.PLAICE,
    "ATLANTIC COD" = COD.ATLANTIC.,
    "HERRING" = HERRING.ATLANTIC.,
    "ATLANTIC HALIBUT" = ATLANTIC.HALIBUT,
    "REDFISH UNSEPARATED" = REDFISH.UNSEPARATED,
    "GREENLAND HALIBUT" = TURBOT..GREENLAND.HALIBUT,
    "HADDOCK" = HADDOCK,
    "SANDLANCES" = SANDLANCES,
    "SILVER HAKE" = SILVER.HAKE,
    "SPINY DOGFISH" = SPINY.DOGFISH,
    "WHITE HAKE" = WHITE.HAKE,
    "WITCH FLOUNDER" = WITCH.FLOUNDER,
    "YELLOWTAIL FLOUNDER" = YELLOWTAIL.FLOUNDER
  )
#biop <- biop %>% select(c(1, 4))
#Abundance per length data cleaning
m <- read.csv("Ess_data/abundance_at_length_DFO_model_spp.csv") %>%
  pivot_longer(!c(length_cm, YEAR), names_to = "SPECIES", values_to = "ABUNDANCE", values_drop_na = TRUE) %>%
  filter(length_cm >= 10) %>%
  group_by(YEAR, SPECIES) %>%
  summarise(ABUNDANCE = sum(ABUNDANCE, na.rm = TRUE), .groups = "drop") %>%
  pivot_wider(names_from = SPECIES, values_from = ABUNDANCE, values_fill = 0)
m <- m %>%
  rename(
    "AMERICAN PLAICE" = AMERICAN.PLAICE,
    "ATLANTIC COD" = COD.ATLANTIC.,
    "HERRING" = HERRING.ATLANTIC.,
    "ATLANTIC HALIBUT" = ATLANTIC.HALIBUT,
    "REDFISH UNSEPARATED" = REDFISH.UNSEPARATED,
    "GREENLAND HALIBUT" = TURBOT..GREENLAND.HALIBUT,
    "HADDOCK" = HADDOCK,
    "SANDLANCES" = SANDLANCES,
    "SILVER HAKE" = SILVER.HAKE,
    "SPINY DOGFISH" = SPINY.DOGFISH,
    "WHITE HAKE" = WHITE.HAKE,
    "WITCH FLOUNDER" = WITCH.FLOUNDER,
    "YELLOWTAIL FLOUNDER" = YELLOWTAIL.FLOUNDER
  )

biomass.p <- biop %>%
  mutate(across(-YEAR, ~ . * 1000))  # Multiply all species columns except YEAR by 1000

common_species <- intersect(names(biomass.p), names(m))

# Compute the ratio for all species
Mean_weight <- biomass.p %>%
  select(all_of(common_species[-1])) %>%  # Exclude "YEAR"
  mutate(across(everything(), ~ .x / m[[cur_column()]])) %>%
  mutate(YEAR = 1970:2010, .before = 1)  # Add YEAR column at the beginning

# View the first few rows
head(Mean_weight )
Mean_weight  <- Mean_weight  %>%
  mutate(across(everything(), ~ ifelse(is.nan(.), 0, .)))
```

MeanWeight plot AMERICAN PLAICE
```{r}
demersal_species <- c("AMERICAN PLAICE")
sims_scen1 <- readRDS("Ess_output/sims_scen1.RDS")
sim_mean<-lapply(sims_scen1,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem<-do.call(rbind.data.frame, sim_mean)
colnames(df_sim_mean_dem) <- paste0("Column_", 1:ncol(df_sim_mean_dem))
df_sim_mean_dem<- df_sim_mean_dem %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem))
sim_dem1 <- df_sim_mean_dem |>
  mutate(Year = year, scen = "Scen1") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
sims_scen2 <- readRDS("Ess_output/sims_scen2.RDS")
sim_mean2<-lapply(sims_scen2,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem2<-do.call(rbind.data.frame, sim_mean2)
colnames(df_sim_mean_dem2) <- paste0("Column_", 1:ncol(df_sim_mean_dem2))
df_sim_mean_dem2<- df_sim_mean_dem2 %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem2$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem2))
sim_dem2 <- df_sim_mean_dem2 |>
  mutate(Year = year, scen = "Scen2") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)

MW <- data.frame(Year = 1970:2010, 
                  MeanWeight = Mean_weight$`AMERICAN PLAICE`)
sim_dem1 <- left_join(sim_dem1, MW, by = "Year")
sim_dem2 <- left_join(sim_dem2, MW, by = "Year")

time_seriess <- rbind(sim_dem1,sim_dem2)
time_seriess <- time_seriess |> rename(MeanWeight=MeanWeight)
time_seriess <- time_seriess  %>%
  mutate(scen = ifelse(Year<1986,
                         "Calibration",scen))

MeanWeight_AMERICAN_PLAICE = ggplot(time_seriess, aes(x=Year, y = MeanWeight, colour=scen, fill=scen)) +
  geom_point(aes(y = MeanWeight), colour="black", size=0.5) +
  geom_ribbon(data = time_seriess, 
              aes(ymin = sim_lower, ymax = sim_upper), alpha=0.3, colour=NA) +
  geom_line(data = time_seriess, 
            aes(y=sim_mean, colour=scen)) +
  scale_colour_manual(name = NULL,  # Removes legend title
                      values = c("grey70", "#4575B4", "#D73027"),
                      labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
  scale_fill_manual(name = NULL,  # Removes legend title
                    values = c("grey70", "#4575B4", "#D73027"),
                    labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
    labs(y = " ", title = "AMERICAN PLAICE") +   # Add title here
  geom_vline(xintercept = 1986, linetype="dashed", color = "black") +
    theme_pubr() +
  theme(legend.position = "none",
        axis.title.x = element_blank(), axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 11, face = "bold"))  # Center the title
MeanWeight_AMERICAN_PLAICE
# ggsave(filename = paste0(save_dir, "MeanWeight_AMERICAN_PLAICE.jpeg"), plot = MeanWeight_AMERICAN_PLAICE,
#        width = 11, height = 8.5, units = "in",dpi = 400)
```


MeanWeight plot ATLANTIC HALIBUT
```{r}
demersal_species <- c("ATLANTIC HALIBUT")
sims_scen1 <- readRDS("Ess_output/sims_scen1.RDS")
sim_mean<-lapply(sims_scen1,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem<-do.call(rbind.data.frame, sim_mean)
colnames(df_sim_mean_dem) <- paste0("Column_", 1:ncol(df_sim_mean_dem))
df_sim_mean_dem<- df_sim_mean_dem %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem))
sim_dem1 <- df_sim_mean_dem |>
  mutate(Year = year, scen = "Scen1") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
sims_scen2 <- readRDS("Ess_output/sims_scen2.RDS")
sim_mean2<-lapply(sims_scen2,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem2<-do.call(rbind.data.frame, sim_mean2)
colnames(df_sim_mean_dem2) <- paste0("Column_", 1:ncol(df_sim_mean_dem2))
df_sim_mean_dem2<- df_sim_mean_dem2 %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem2$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem2))
sim_dem2 <- df_sim_mean_dem2 |>
  mutate(Year = year, scen = "Scen2") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)

MW <- data.frame(Year = 1970:2010, 
                  MeanWeight = Mean_weight$`ATLANTIC HALIBUT`)
sim_dem1 <- left_join(sim_dem1, MW, by = "Year")
sim_dem2 <- left_join(sim_dem2, MW, by = "Year")

time_seriess <- rbind(sim_dem1,sim_dem2)
time_seriess <- time_seriess |> rename(MeanWeight=MeanWeight)
time_seriess <- time_seriess  %>%
  mutate(scen = ifelse(Year<1986,
                         "Calibration",scen))

MeanWeight_ATLANTIC_HALIBUT= ggplot(time_seriess, aes(x=Year, y = MeanWeight, colour=scen, fill=scen)) +
  geom_point(aes(y = MeanWeight), colour="black", size=0.5) +
  geom_ribbon(data = time_seriess, 
              aes(ymin = sim_lower, ymax = sim_upper), alpha=0.3, colour=NA) +
  geom_line(data = time_seriess, 
            aes(y=sim_mean, colour=scen)) +
  scale_colour_manual(name = NULL,  # Removes legend title
                      values = c("grey70", "#4575B4", "#D73027"),
                      labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
  scale_fill_manual(name = NULL,  # Removes legend title
                    values = c("grey70", "#4575B4", "#D73027"),
                    labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
    labs(y = " ", title = "ATLANTIC HALIBUT") +   # Add title here
  geom_vline(xintercept = 1986, linetype="dashed", color = "black") +
   theme_pubr() +
  theme(legend.position = "none",
        axis.title.x = element_blank(), axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 11, face = "bold"))  # Center the title
MeanWeight_ATLANTIC_HALIBUT
# ggsave(filename = paste0(save_dir, "MeanWeight_ATLANTIC_HALIBUT.jpeg"), plot = MeanWeight_AMERICAN_PLAICE,
#        width = 11, height = 8.5, units = "in",dpi = 400)
```



MeanWeight plot ATLANTIC COD
```{r}
demersal_species <- c("COD(ATLANTIC)")
sims_scen1 <- readRDS("Ess_output/sims_scen1.RDS")
sim_mean<-lapply(sims_scen1,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem<-do.call(rbind.data.frame, sim_mean)
colnames(df_sim_mean_dem) <- paste0("Column_", 1:ncol(df_sim_mean_dem))
df_sim_mean_dem<- df_sim_mean_dem %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem))
sim_dem1 <- df_sim_mean_dem |>
  mutate(Year = year, scen = "Scen1") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
sims_scen2 <- readRDS("Ess_output/sims_scen2.RDS")
sim_mean2<-lapply(sims_scen2,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem2<-do.call(rbind.data.frame, sim_mean2)
colnames(df_sim_mean_dem2) <- paste0("Column_", 1:ncol(df_sim_mean_dem2))
df_sim_mean_dem2<- df_sim_mean_dem2 %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem2$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem2))
sim_dem2 <- df_sim_mean_dem2 |>
  mutate(Year = year, scen = "Scen2") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
MW <- data.frame(Year = 1970:2010, 
                  MeanWeight = Mean_weight$`ATLANTIC COD`)
sim_dem1 <- left_join(sim_dem1, MW, by = "Year")
sim_dem2 <- left_join(sim_dem2, MW, by = "Year")

time_seriess <- rbind(sim_dem1,sim_dem2)
time_seriess <- time_seriess |> rename(MeanWeight=MeanWeight)
time_seriess <- time_seriess  %>%
  mutate(scen = ifelse(Year<1986,
                         "Calibration",scen))

MeanWeight_ATLANTIC_COD = ggplot(time_seriess, aes(x=Year, y = MeanWeight, colour=scen, fill=scen)) +
  geom_point(aes(y = MeanWeight), colour="black", size=0.5) +
  geom_ribbon(data = time_seriess, 
              aes(ymin = sim_lower, ymax = sim_upper), alpha=0.3, colour=NA) +
  geom_line(data = time_seriess, 
            aes(y=sim_mean, colour=scen)) +
  scale_colour_manual(name = NULL,  # Removes legend title
                      values = c("grey70", "#4575B4", "#D73027"),
                      labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
  scale_fill_manual(name = NULL,  # Removes legend title
                    values = c("grey70", "#4575B4", "#D73027"),
                    labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
    labs(y = " ", title = "ATLANTIC COD") +   # Add title here
  geom_vline(xintercept = 1986, linetype="dashed", color = "black") +
  theme_pubr() +
   theme(legend.position = "none",
        axis.title.x = element_blank(), axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 11, face = "bold"))  # Center the title
MeanWeight_ATLANTIC_COD
# ggsave(filename = paste0(save_dir, "MeanWeight_ATLANTIC_COD.jpeg"), plot = MeanWeight_AMERICAN_PLAICE,
#        width = 11, height = 8.5, units = "in",dpi = 400)
```

MeanWeight plot HADDOCK
```{r}
demersal_species <- c("HADDOCK")
sims_scen1 <- readRDS("Ess_output/sims_scen1.RDS")
sim_mean<-lapply(sims_scen1,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem<-do.call(rbind.data.frame, sim_mean)
colnames(df_sim_mean_dem) <- paste0("Column_", 1:ncol(df_sim_mean_dem))
df_sim_mean_dem<- df_sim_mean_dem %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem))
sim_dem1 <- df_sim_mean_dem |>
  mutate(Year = year, scen = "Scen1") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
sims_scen2 <- readRDS("Ess_output/sims_scen2.RDS")
sim_mean2<-lapply(sims_scen2,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem2<-do.call(rbind.data.frame, sim_mean2)
colnames(df_sim_mean_dem2) <- paste0("Column_", 1:ncol(df_sim_mean_dem2))
df_sim_mean_dem2<- df_sim_mean_dem2 %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem2$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem2))
sim_dem2 <- df_sim_mean_dem2 |>
  mutate(Year = year, scen = "Scen2") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
MW <- data.frame(Year = 1970:2010, 
                  MeanWeight = Mean_weight$`HADDOCK`)
sim_dem1 <- left_join(sim_dem1, MW, by = "Year")
sim_dem2 <- left_join(sim_dem2, MW, by = "Year")

time_seriess <- rbind(sim_dem1,sim_dem2)
time_seriess <- time_seriess |> rename(MeanWeight=MeanWeight)
time_seriess <- time_seriess  %>%
  mutate(scen = ifelse(Year<1986,
                         "Calibration",scen))

MeanWeight_HADDOCK = ggplot(time_seriess, aes(x=Year, y = MeanWeight, colour=scen, fill=scen)) +
  geom_point(aes(y = MeanWeight), colour="black", size=0.5) +
  geom_ribbon(data = time_seriess, 
              aes(ymin = sim_lower, ymax = sim_upper), alpha=0.3, colour=NA) +
  geom_line(data = time_seriess, 
            aes(y=sim_mean, colour=scen)) +
  scale_colour_manual(name = NULL,  # Removes legend title
                      values = c("grey70", "#4575B4", "#D73027"),
                      labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
  scale_fill_manual(name = NULL,  # Removes legend title
                    values = c("grey70", "#4575B4", "#D73027"),
                    labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
    labs(y = " ", title = "HADDOCK") +   # Add title here
  geom_vline(xintercept = 1986, linetype="dashed", color = "black") +
  theme_pubr() +
   theme(legend.position = "none",
        axis.title.x = element_blank(), axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 11, face = "bold"))  # Center the title
MeanWeight_HADDOCK
# ggsave(filename = paste0(save_dir, "MeanWeight_HADDOCK.jpeg"), plot = MeanWeight_AMERICAN_PLAICE,
#        width = 11, height = 8.5, units = "in",dpi = 400)
```


MeanWeight plot REDFISH UNSEPARATED
```{r}
demersal_species <- c("REDFISH UNSEPARATED")
sims_scen1 <- readRDS("Ess_output/sims_scen1.RDS")
sim_mean<-lapply(sims_scen1,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem<-do.call(rbind.data.frame, sim_mean)
colnames(df_sim_mean_dem) <- paste0("Column_", 1:ncol(df_sim_mean_dem))
df_sim_mean_dem<- df_sim_mean_dem %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem))
sim_dem1 <- df_sim_mean_dem |>
  mutate(Year = year, scen = "Scen1") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
sims_scen2 <- readRDS("Ess_output/sims_scen2.RDS")
sim_mean2<-lapply(sims_scen2,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem2<-do.call(rbind.data.frame, sim_mean2)
colnames(df_sim_mean_dem2) <- paste0("Column_", 1:ncol(df_sim_mean_dem2))
df_sim_mean_dem2<- df_sim_mean_dem2 %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem2$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem2))
sim_dem2 <- df_sim_mean_dem2 |>
  mutate(Year = year, scen = "Scen2") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
MW <- data.frame(Year = 1970:2010, 
                  MeanWeight = Mean_weight$`REDFISH UNSEPARATED`)
sim_dem1 <- left_join(sim_dem1, MW, by = "Year")
sim_dem2 <- left_join(sim_dem2, MW, by = "Year")

time_seriess <- rbind(sim_dem1,sim_dem2)
time_seriess <- time_seriess |> rename(MeanWeight=MeanWeight)
time_seriess <- time_seriess  %>%
  mutate(scen = ifelse(Year<1986,
                         "Calibration",scen))

MeanWeight_REDFISH = ggplot(time_seriess, aes(x=Year, y = MeanWeight, colour=scen, fill=scen)) +
  geom_point(aes(y = MeanWeight), colour="black", size=0.5) +
  geom_ribbon(data = time_seriess, 
              aes(ymin = sim_lower, ymax = sim_upper), alpha=0.3, colour=NA) +
  geom_line(data = time_seriess, 
            aes(y=sim_mean, colour=scen)) +
  scale_colour_manual(name = NULL,  # Removes legend title
                      values = c("grey70", "#4575B4", "#D73027"),
                      labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
  scale_fill_manual(name = NULL,  # Removes legend title
                    values = c("grey70", "#4575B4", "#D73027"),
                    labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
    labs(y = "Mean Weight", title = "REDFISH UNSEPARATED") +   # Add title here
  geom_vline(xintercept = 1986, linetype="dashed", color = "black") +
  theme_pubr() +
   theme(legend.position = "none",
         axis.title.y = element_text(size = 9, face = "bold"),
        axis.title.x = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 11, face = "bold"))  # Center the title
MeanWeight_REDFISH
# ggsave(filename = paste0(save_dir, "MeanWeight_REDFISH.jpeg"), plot = MeanWeight_AMERICAN_PLAICE,
#        width = 11, height = 8.5, units = "in",dpi = 400)
```
MeanWeight plot HERRINGS
```{r}
demersal_species <- c("HERRING(ATLANTIC)")
sims_scen1 <- readRDS("Ess_output/sims_scen1.RDS")
sim_mean<-lapply(sims_scen1,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem<-do.call(rbind.data.frame, sim_mean)
colnames(df_sim_mean_dem) <- paste0("Column_", 1:ncol(df_sim_mean_dem))
df_sim_mean_dem<- df_sim_mean_dem %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem))
sim_dem1 <- df_sim_mean_dem |>
  mutate(Year = year, scen = "Scen1") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
sims_scen2 <- readRDS("Ess_output/sims_scen2.RDS")
sim_mean2<-lapply(sims_scen2,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem2<-do.call(rbind.data.frame, sim_mean2)
colnames(df_sim_mean_dem2) <- paste0("Column_", 1:ncol(df_sim_mean_dem2))
df_sim_mean_dem2<- df_sim_mean_dem2 %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem2$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem2))
sim_dem2 <- df_sim_mean_dem2 |>
  mutate(Year = year, scen = "Scen2") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
MW <- data.frame(Year = 1970:2010, 
                  MeanWeight = Mean_weight$`HERRING`)
sim_dem1 <- left_join(sim_dem1, MW, by = "Year")
sim_dem2 <- left_join(sim_dem2, MW, by = "Year")

time_seriess <- rbind(sim_dem1,sim_dem2)
time_seriess <- time_seriess |> rename(MeanWeight=MeanWeight)
time_seriess <- time_seriess  %>%
  mutate(scen = ifelse(Year<1986,
                         "Calibration",scen))

MeanWeight_HERRING = ggplot(time_seriess, aes(x=Year, y = MeanWeight, colour=scen, fill=scen)) +
  geom_point(aes(y = MeanWeight), colour="black", size=0.5) +
  geom_ribbon(data = time_seriess, 
              aes(ymin = sim_lower, ymax = sim_upper), alpha=0.3, colour=NA) +
  geom_line(data = time_seriess, 
            aes(y=sim_mean, colour=scen)) +
  scale_colour_manual(name = NULL,  # Removes legend title
                      values = c("grey70", "#4575B4", "#D73027"),
                      labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
  scale_fill_manual(name = NULL,  # Removes legend title
                    values = c("grey70", "#4575B4", "#D73027"),
                    labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
    labs(y = " ", title = "HERRING") +   # Add title here
  geom_vline(xintercept = 1986, linetype="dashed", color = "black") +
  theme_pubr() +
   theme(legend.position = "none",
        axis.title.x = element_blank(), axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 11, face = "bold"))  # Center the title
MeanWeight_HERRING
# ggsave(filename = paste0(save_dir, "MeanWeight_HERRING.jpeg"), plot = MeanWeight_HERRING,
#        width = 11, height = 8.5, units = "in",dpi = 400)
```


MeanWeight plot SANDLANCES
```{r}
demersal_species <- c("SANDLANCES")
sims_scen1 <- readRDS("Ess_output/sims_scen1.RDS")
sim_mean<-lapply(sims_scen1,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem<-do.call(rbind.data.frame, sim_mean)
colnames(df_sim_mean_dem) <- paste0("Column_", 1:ncol(df_sim_mean_dem))
df_sim_mean_dem<- df_sim_mean_dem %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem))
sim_dem1 <- df_sim_mean_dem |>
  mutate(Year = year, scen = "Scen1") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
sims_scen2 <- readRDS("Ess_output/sims_scen2.RDS")
sim_mean2<-lapply(sims_scen2,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem2<-do.call(rbind.data.frame, sim_mean2)
colnames(df_sim_mean_dem2) <- paste0("Column_", 1:ncol(df_sim_mean_dem2))
df_sim_mean_dem2<- df_sim_mean_dem2 %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem2$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem2))
sim_dem2 <- df_sim_mean_dem2 |>
  mutate(Year = year, scen = "Scen2") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
MW <- data.frame(Year = 1970:2010, 
                  MeanWeight = Mean_weight$`SANDLANCES`)
sim_dem1 <- left_join(sim_dem1, MW, by = "Year")
sim_dem2 <- left_join(sim_dem2, MW, by = "Year")

time_seriess <- rbind(sim_dem1,sim_dem2)
time_seriess <- time_seriess |> rename(MeanWeight=MeanWeight)
time_seriess <- time_seriess  %>%
  mutate(scen = ifelse(Year<1986,
                         "Calibration",scen))

MeanWeight_SANDLANCES = ggplot(time_seriess, aes(x=Year, y = MeanWeight, colour=scen, fill=scen)) +
  geom_point(aes(y = MeanWeight), colour="black", size=0.5) +
  geom_ribbon(data = time_seriess, 
              aes(ymin = sim_lower, ymax = sim_upper), alpha=0.3, colour=NA) +
  geom_line(data = time_seriess, 
            aes(y=sim_mean, colour=scen)) +
  scale_colour_manual(name = NULL,  # Removes legend title
                      values = c("grey70", "#4575B4", "#D73027"),
                      labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
  scale_fill_manual(name = NULL,  # Removes legend title
                    values = c("grey70", "#4575B4", "#D73027"),
                    labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
    labs(y = " ", title = "SANDLANCES") +   # Add title here
  geom_vline(xintercept = 1986, linetype="dashed", color = "black") +
  theme_pubr() +
   theme(legend.position = "none",
        axis.title.x = element_blank(), axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 11, face = "bold"))  # Center the title
MeanWeight_SANDLANCES
# ggsave(filename = paste0(save_dir, "MeanWeight_SANDLANCES.jpeg"), plot = MeanWeight_SANDLANCES,
#        width = 11, height = 8.5, units = "in",dpi = 400)
```



MeanWeight plot SILVER HAKE
```{r}
demersal_species <- c("SILVER HAKE")
sims_scen1 <- readRDS("Ess_output/sims_scen1.RDS")
sim_mean<-lapply(sims_scen1,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem<-do.call(rbind.data.frame, sim_mean)
colnames(df_sim_mean_dem) <- paste0("Column_", 1:ncol(df_sim_mean_dem))
df_sim_mean_dem<- df_sim_mean_dem %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem))
sim_dem1 <- df_sim_mean_dem |>
  mutate(Year = year, scen = "Scen1") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
sims_scen2 <- readRDS("Ess_output/sims_scen2.RDS")
sim_mean2<-lapply(sims_scen2,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem2<-do.call(rbind.data.frame, sim_mean2)
colnames(df_sim_mean_dem2) <- paste0("Column_", 1:ncol(df_sim_mean_dem2))
df_sim_mean_dem2<- df_sim_mean_dem2 %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem2$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem2))
sim_dem2 <- df_sim_mean_dem2 |>
  mutate(Year = year, scen = "Scen2") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
MW <- data.frame(Year = 1970:2010, 
                  MeanWeight = Mean_weight$`SILVER HAKE`)
sim_dem1 <- left_join(sim_dem1, MW, by = "Year")
sim_dem2 <- left_join(sim_dem2, MW, by = "Year")

time_seriess <- rbind(sim_dem1,sim_dem2)
time_seriess <- time_seriess |> rename(MeanWeight=MeanWeight)
time_seriess <- time_seriess  %>%
  mutate(scen = ifelse(Year<1986,
                         "Calibration",scen))

MeanWeight_SILVER_HAKE = ggplot(time_seriess, aes(x=Year, y = MeanWeight, colour=scen, fill=scen)) +
  geom_point(aes(y = MeanWeight), colour="black", size=0.5) +
  geom_ribbon(data = time_seriess, 
              aes(ymin = sim_lower, ymax = sim_upper), alpha=0.3, colour=NA) +
  geom_line(data = time_seriess, 
            aes(y=sim_mean, colour=scen)) +
  scale_colour_manual(name = NULL,  # Removes legend title
                      values = c("grey70", "#4575B4", "#D73027"),
                      labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
  scale_fill_manual(name = NULL,  # Removes legend title
                    values = c("grey70", "#4575B4", "#D73027"),
                    labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
    labs(y = " ", title = "SILVER HAKE") +   # Add title here
  geom_vline(xintercept = 1986, linetype="dashed", color = "black") +
  theme_pubr() +
   theme(legend.position = "none",
        axis.title.x = element_blank(), axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 11, face = "bold"))  # Center the title
MeanWeight_SILVER_HAKE
# ggsave(filename = paste0(save_dir, "MeanWeight_SILVER_HAKE.jpeg"), plot = MeanWeight_SILVER_HAKE,
#        width = 11, height = 8.5, units = "in",dpi = 400)
```


MeanWeight plot SPINY DOGFISH
```{r}
demersal_species <- c("SPINY DOGFISH")
sims_scen1 <- readRDS("Ess_output/sims_scen1.RDS")
sim_mean<-lapply(sims_scen1,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem<-do.call(rbind.data.frame, sim_mean)
colnames(df_sim_mean_dem) <- paste0("Column_", 1:ncol(df_sim_mean_dem))
df_sim_mean_dem<- df_sim_mean_dem %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem))
sim_dem1 <- df_sim_mean_dem |>
  mutate(Year = year, scen = "Scen1") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
sims_scen2 <- readRDS("Ess_output/sims_scen2.RDS")
sim_mean2<-lapply(sims_scen2,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem2<-do.call(rbind.data.frame, sim_mean2)
colnames(df_sim_mean_dem2) <- paste0("Column_", 1:ncol(df_sim_mean_dem2))
df_sim_mean_dem2<- df_sim_mean_dem2 %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem2$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem2))
sim_dem2 <- df_sim_mean_dem2 |>
  mutate(Year = year, scen = "Scen2") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
MW <- data.frame(Year = 1970:2010, 
                  MeanWeight = Mean_weight$`SPINY DOGFISH`)
sim_dem1 <- left_join(sim_dem1, MW, by = "Year")
sim_dem2 <- left_join(sim_dem2, MW, by = "Year")

time_seriess <- rbind(sim_dem1,sim_dem2)
time_seriess <- time_seriess |> rename(MeanWeight=MeanWeight)
time_seriess <- time_seriess  %>%
  mutate(scen = ifelse(Year<1986,
                         "Calibration",scen))

MeanWeight_SPINY_DOGFISH = ggplot(time_seriess, aes(x=Year, y = MeanWeight, colour=scen, fill=scen)) +
  geom_point(aes(y = MeanWeight), colour="black", size=0.5) +
  geom_ribbon(data = time_seriess, 
              aes(ymin = sim_lower, ymax = sim_upper), alpha=0.3, colour=NA) +
  geom_line(data = time_seriess, 
            aes(y=sim_mean, colour=scen)) +
  scale_colour_manual(name = NULL,  # Removes legend title
                      values = c("grey70", "#4575B4", "#D73027"),
                      labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
  scale_fill_manual(name = NULL,  # Removes legend title
                    values = c("grey70", "#4575B4", "#D73027"),
                    labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
    labs(y = " ", title = "SPINY DOGFISH") +   # Add title here
  geom_vline(xintercept = 1986, linetype="dashed", color = "black") +
  theme_pubr() +
   theme(legend.position = "none",
        axis.title.x = element_blank(), axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 11, face = "bold"))  # Center the title
MeanWeight_SPINY_DOGFISH
# ggsave(filename = paste0(save_dir, "MeanWeight_SPINY_DOGFISH.jpeg"), plot = MeanWeight_SPINY_DOGFISH,
#        width = 11, height = 8.5, units = "in",dpi = 400)
```


MeanWeight plot GREENLAND HALIBUT
```{r}
demersal_species <- c("TURBOT, GREENLAND HALIBUT")
sims_scen1 <- readRDS("Ess_output/sims_scen1.RDS")
sim_mean<-lapply(sims_scen1,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem<-do.call(rbind.data.frame, sim_mean)
colnames(df_sim_mean_dem) <- paste0("Column_", 1:ncol(df_sim_mean_dem))
df_sim_mean_dem<- df_sim_mean_dem %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem))
sim_dem1 <- df_sim_mean_dem |>
  mutate(Year = year, scen = "Scen1") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
sims_scen2 <- readRDS("Ess_output/sims_scen2.RDS")
sim_mean2<-lapply(sims_scen2,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem2<-do.call(rbind.data.frame, sim_mean2)
colnames(df_sim_mean_dem2) <- paste0("Column_", 1:ncol(df_sim_mean_dem2))
df_sim_mean_dem2<- df_sim_mean_dem2 %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem2$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem2))
sim_dem2 <- df_sim_mean_dem2 |>
  mutate(Year = year, scen = "Scen2") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
MW <- data.frame(Year = 1970:2010, 
                  MeanWeight = Mean_weight$`GREENLAND HALIBUT`)
sim_dem1 <- left_join(sim_dem1, MW, by = "Year")
sim_dem2 <- left_join(sim_dem2, MW, by = "Year")

time_seriess <- rbind(sim_dem1,sim_dem2)
time_seriess <- time_seriess |> rename(MeanWeight=MeanWeight)
time_seriess <- time_seriess  %>%
  mutate(scen = ifelse(Year<1986,
                         "Calibration",scen))

MeanWeight_GREENLAND = ggplot(time_seriess, aes(x=Year, y = MeanWeight, colour=scen, fill=scen)) +
  geom_point(aes(y = MeanWeight), colour="black", size=0.5) +
  geom_ribbon(data = time_seriess, 
              aes(ymin = sim_lower, ymax = sim_upper), alpha=0.3, colour=NA) +
  geom_line(data = time_seriess, 
            aes(y=sim_mean, colour=scen)) +
  scale_colour_manual(name = NULL,  # Removes legend title
                      values = c("grey70", "#4575B4", "#D73027"),
                      labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
  scale_fill_manual(name = NULL,  # Removes legend title
                    values = c("grey70", "#4575B4", "#D73027"),
                    labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
    labs(y = " ", title = "GREENLAND HALIBUT") +   # Add title here
  geom_vline(xintercept = 1986, linetype="dashed", color = "black") +
  theme_pubr() +
   theme(legend.position = "none",
        axis.title.x = element_blank(), axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 11, face = "bold"))  # Center the title
MeanWeight_GREENLAND
# ggsave(filename = paste0(save_dir, "MeanWeight_GREENLAND.jpeg"), plot = MeanWeight_AMERICAN_PLAICE,
#        width = 11, height = 8.5, units = "in",dpi = 400)
```



MeanWeight plot WHITE HAKE
```{r}
demersal_species <- c("WHITE HAKE")
sims_scen1 <- readRDS("Ess_output/sims_scen1.RDS")
sim_mean<-lapply(sims_scen1,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem<-do.call(rbind.data.frame, sim_mean)
colnames(df_sim_mean_dem) <- paste0("Column_", 1:ncol(df_sim_mean_dem))
df_sim_mean_dem<- df_sim_mean_dem %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem))
sim_dem1 <- df_sim_mean_dem |>
  mutate(Year = year, scen = "Scen1") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
sims_scen2 <- readRDS("Ess_output/sims_scen2.RDS")
sim_mean2<-lapply(sims_scen2,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem2<-do.call(rbind.data.frame, sim_mean2)
colnames(df_sim_mean_dem2) <- paste0("Column_", 1:ncol(df_sim_mean_dem2))
df_sim_mean_dem2<- df_sim_mean_dem2 %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem2$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem2))
sim_dem2 <- df_sim_mean_dem2 |>
  mutate(Year = year, scen = "Scen2") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
MW <- data.frame(Year = 1970:2010, 
                  MeanWeight = Mean_weight$`WHITE HAKE`)
sim_dem1 <- left_join(sim_dem1, MW, by = "Year")
sim_dem2 <- left_join(sim_dem2, MW, by = "Year")

time_seriess <- rbind(sim_dem1,sim_dem2)
time_seriess <- time_seriess |> rename(MeanWeight=MeanWeight)
time_seriess <- time_seriess  %>%
  mutate(scen = ifelse(Year<1986,
                         "Calibration",scen))

MeanWeight_WHITE_HAKE = ggplot(time_seriess, aes(x=Year, y = MeanWeight, colour=scen, fill=scen)) +
  geom_point(aes(y = MeanWeight), colour="black", size=0.5) +
  geom_ribbon(data = time_seriess, 
              aes(ymin = sim_lower, ymax = sim_upper), alpha=0.3, colour=NA) +
  geom_line(data = time_seriess, 
            aes(y=sim_mean, colour=scen)) +
  scale_colour_manual(name = NULL,  # Removes legend title
                      values = c("grey70", "#4575B4", "#D73027"),
                      labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
  scale_fill_manual(name = NULL,  # Removes legend title
                    values = c("grey70", "#4575B4", "#D73027"),
                    labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
    labs(y = " ", title = "WHITE HAKE") +   # Add title here
  geom_vline(xintercept = 1986, linetype="dashed", color = "black") +
  theme_pubr() +
   theme(legend.position = "none",
        axis.title.x = element_blank(), axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5, size = 11, face = "bold"))  # Center the title
MeanWeight_WHITE_HAKE
# ggsave(filename = paste0(save_dir, "MeanWeight_WHITE_HAKE.jpeg"), plot = MeanWeight_WHITE_HAKE,
#        width = 11, height = 8.5, units = "in",dpi = 400)
```


MeanWeight plot WITCH FLOUNDER
```{r}
demersal_species <- c("WITCH FLOUNDER")
sims_scen1 <- readRDS("Ess_output/sims_scen1.RDS")
sim_mean<-lapply(sims_scen1,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem<-do.call(rbind.data.frame, sim_mean)
colnames(df_sim_mean_dem) <- paste0("Column_", 1:ncol(df_sim_mean_dem))
df_sim_mean_dem<- df_sim_mean_dem %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem))
sim_dem1 <- df_sim_mean_dem |>
  mutate(Year = year, scen = "Scen1") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
sims_scen2 <- readRDS("Ess_output/sims_scen2.RDS")
sim_mean2<-lapply(sims_scen2,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem2<-do.call(rbind.data.frame, sim_mean2)
colnames(df_sim_mean_dem2) <- paste0("Column_", 1:ncol(df_sim_mean_dem2))
df_sim_mean_dem2<- df_sim_mean_dem2 %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem2$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem2))
sim_dem2 <- df_sim_mean_dem2 |>
  mutate(Year = year, scen = "Scen2") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
MW <- data.frame(Year = 1970:2010, 
                  MeanWeight = Mean_weight$`WITCH FLOUNDER`)
sim_dem1 <- left_join(sim_dem1, MW, by = "Year")
sim_dem2 <- left_join(sim_dem2, MW, by = "Year")

time_seriess <- rbind(sim_dem1,sim_dem2)
time_seriess <- time_seriess |> rename(MeanWeight=MeanWeight)
time_seriess <- time_seriess  %>%
  mutate(scen = ifelse(Year<1986,
                         "Calibration",scen))

MeanWeight_WITCH_FLOUNDER = ggplot(time_seriess, aes(x=Year, y = MeanWeight, colour=scen, fill=scen)) +
  geom_point(aes(y = MeanWeight), colour="black", size=0.5) +
  geom_ribbon(data = time_seriess, 
              aes(ymin = sim_lower, ymax = sim_upper), alpha=0.3, colour=NA) +
  geom_line(data = time_seriess, 
            aes(y=sim_mean, colour=scen)) +
  scale_colour_manual(name = NULL,  # Removes legend title
                      values = c("grey70", "#4575B4", "#D73027"),
                      labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
  scale_fill_manual(name = NULL,  # Removes legend title
                    values = c("grey70", "#4575B4", "#D73027"),
                    labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
    labs(y = " ", title = "WITCH FLOUNDER") +   # Add title here
  geom_vline(xintercept = 1986, linetype="dashed", color = "black") +
  theme_pubr() +
   theme(legend.position = "none",
        axis.title.x = element_blank(), axis.title.y = element_blank(),
        plot.title = element_text(hjust = 0.5, size =11, face = "bold"))  # Center the title
MeanWeight_WITCH_FLOUNDER
# ggsave(filename = paste0(save_dir, "MeanWeight_WITCH_FLOUNDER.jpeg"), plot = MeanWeight_WITCH_FLOUNDER,
#        width = 11, height = 8.5, units = "in",dpi = 400)
```

MeanWeight plot YELLOW FLOUNDER
```{r}
demersal_species <- c("YELLOWTAIL FLOUNDER")
sims_scen1 <- readRDS("Ess_output/sims_scen1.RDS")
sim_mean<-lapply(sims_scen1,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem<-do.call(rbind.data.frame, sim_mean)
colnames(df_sim_mean_dem) <- paste0("Column_", 1:ncol(df_sim_mean_dem))
df_sim_mean_dem<- df_sim_mean_dem %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem))
sim_dem1 <- df_sim_mean_dem |>
  mutate(Year = year, scen = "Scen1") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
sims_scen2 <- readRDS("Ess_output/sims_scen2.RDS")
sim_mean2<-lapply(sims_scen2,getMeanWeight,min_w=species_params(params)$biomass_cutoff, species = demersal_species )
df_sim_mean_dem2<-do.call(rbind.data.frame, sim_mean2)
colnames(df_sim_mean_dem2) <- paste0("Column_", 1:ncol(df_sim_mean_dem2))
df_sim_mean_dem2<- df_sim_mean_dem2 %>%pivot_longer(cols = everything(), names_to = "year", values_to = "MeanWeight")
df_sim_mean_dem2$year <- rep(1970:2010, length.out = nrow(df_sim_mean_dem2))
sim_dem2 <- df_sim_mean_dem2 |>
  mutate(Year = year, scen = "Scen2") |>  
  group_by(Year, scen) |>  
  summarise(
    sim_mean = median(MeanWeight, na.rm = TRUE),
    sim_lower = min(MeanWeight, na.rm = TRUE),
    sim_upper = max(MeanWeight, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  filter(Year >= 1970 & Year <= 2010)
MW <- data.frame(Year = 1970:2010, 
                  MeanWeight = Mean_weight$`YELLOWTAIL FLOUNDER`)
sim_dem1 <- left_join(sim_dem1, MW, by = "Year")
sim_dem2 <- left_join(sim_dem2, MW, by = "Year")

time_seriess <- rbind(sim_dem1,sim_dem2)
time_seriess <- time_seriess |> rename(MeanWeight=MeanWeight)
time_seriess <- time_seriess  %>%
  mutate(scen = ifelse(Year<1986,
                         "Calibration",scen))

MeanWeight_YELLOW_FLOUNDER = ggplot(time_seriess, aes(x=Year, y = MeanWeight, colour=scen, fill=scen)) +
  geom_point(aes(y = MeanWeight), colour="black", size=0.5) +
  geom_ribbon(data = time_seriess, 
              aes(ymin = sim_lower, ymax = sim_upper), alpha=0.3, colour=NA) +
  geom_line(data = time_seriess, 
            aes(y=sim_mean, colour=scen)) +
  scale_colour_manual(name = NULL,  # Removes legend title
                      values = c("grey70", "#4575B4", "#D73027"),
                      labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
  scale_fill_manual(name = NULL,  # Removes legend title
                    values = c("grey70", "#4575B4", "#D73027"),
                    labels = c("Calibration", "Fishing mortality only", "Fishing with additional mortality")) +
    labs(y = " ", title = "YELLOWTAIL FLOUNDER") +   # Add title here
  geom_vline(xintercept = 1986, linetype="dashed", color = "black") +
  theme_pubr() +
  theme(
    legend.position = "none",  # Position the legend on the right
    axis.title.x = element_blank(),  # Remove x-axis title
    axis.title.y = element_blank(),  # Remove y-axis title
    plot.title = element_text(hjust = 0.5, size = 11, face = "bold")  # Center and bold the title
  )
MeanWeight_YELLOW_FLOUNDER
# ggsave(filename = paste0(save_dir, "MeanWeight_YELLOW_FLOUNDER.jpeg"), plot = MeanWeight_YELLOW_FLOUNDER,
#        width = 11, height = 8.5, units = "in",dpi = 400)
```

plots combined

```{r}
library(gridExtra)

# Assuming each individual plot (MeanWeight_X) is defined, arrange them in a 4x4 grid
 
indicator_plots <- grid.arrange(
  MeanWeight_AMERICAN_PLAICE, MeanWeight_ATLANTIC_HALIBUT, MeanWeight_ATLANTIC_COD, MeanWeight_HADDOCK,
  MeanWeight_REDFISH, MeanWeight_GREENLAND, MeanWeight_SANDLANCES, MeanWeight_SILVER_HAKE,
  MeanWeight_SPINY_DOGFISH, MeanWeight_GREENLAND, MeanWeight_WHITE_HAKE, MeanWeight_WITCH_FLOUNDER,
  MeanWeight_YELLOW_FLOUNDER, ncol = 4, nrow = 4
)


print(indicator_plots)
ggsave(filename = paste0(save_dir, "indicator_plots.jpeg"), plot = indicator_plots,width = 11, height = 8.5, units = "in",dpi = 400)
```

